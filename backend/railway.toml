[build]
builder = "nixpacks"
watch = ["package.json", "src/**"]

[deploy]
healthcheckPath = "/api/v1/health"
healthcheckTimeout = 30
restartPolicyType = "onFailure"
restartPolicyMaxRetries = 3

[build.buildPhase]
command = "npm install && npm run build"

[build.startPhase]
command = "npm start"

[environment]
NODE_ENV = "production"
PORT = "5000"

[[services]]
name = "devrhythm-backend"
port = 5000
autoscaling = { enabled = true, min = 2, max = 3 }
cpu = { limit = "1" }
memory = { limit = "512MB" }

[services.checks.http]
path = "/api/v1/health"
interval = "10s"
timeout = "5s"
initialDelay = "10s"

[services.checks.tcp]
port = 5000
interval = "30s"
timeout = "5s"
initialDelay = "10s"